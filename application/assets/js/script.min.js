$(document).ready(function(){var s,n,i=0,a=-1,o=[],r=0,c=0,d=[],l=0,u="",v="",f=!0,p=[];$("div#window-status").text(!1);var e,t=(e=!1,function(){e||(e=!0,_("geolocation"))});function g(){o.length=0;var e=new Applait.Finder({type:"sdcard",debugMode:!0});e.on("empty",function(e){}),e.search("custom-launcher.json"),e.on("fileFound",function(e,i,t){var s=new FileReader;s.onerror=function(e){alert("shit happens"),s.abort()},s.onloadend=function(e){search_result=e.target.result;var i=JSON.parse(search_result);$.each(i,function(e,i){null==i.dir?o.push([i.app_name,"root"]):o.push([i.app_name,i.dir]),i.weather&&(""==(u=i.weather.owm_api_key)&&$("div#weather-wrapper").remove(),$.each(i.weather.location,function(e,i){d.push([e,i.position_lat,i.position_long])}))}),function(i){a=-1,$("div#app-list").empty();var s=window.navigator.mozApps.mgmt.getAll();s.onsuccess=function(){if(s.result){var e=s.result;if(1==i)$.each(e,function(e,i){a++,$("div#app-list").append('<div class="items" tabindex="0" data-url="'+a+'">'+i.manifest.name+"</div>")});else for(var t=0;t<o.length-1;t++)$.each(e,function(e,i){i.manifest.name==o[t][0]&&("root"==o[t][1]&&$("div#app-list").append('<div class="items" tabindex="0" data-app_name = "'+i.manifest.name+'"data-url="'+e+'">'+i.manifest.name+"</div>"),"root"!=o[t][1]&&(-1==$.inArray(o[t][1],b)?(b.push(o[t][1]),$("div#app-list").append('<div class="items dir  '+o[t][1]+'" tabindex="0" data-app_name = "'+i.manifest.name+'"data-url="'+e+'"><span class="dir-name">'+o[t][1]+'</span><span class="app-name">'+i.manifest.name+"</span></div>")):$("div#app-list").append('<div class="items dir child-of-dir '+o[t][1]+'" tabindex="0" data-app_name = "'+i.manifest.name+'"data-url="'+e+'"><span class="dir-name">'+o[t][1]+'</span><span class="app-name">'+i.manifest.name+"</span></div>")))});v=$("div#app-list > div.items:visible"),c=0,w()}else alert("No apps")},s.onerror=function(){alert("Error: "+s.error.name)}}(),$(".page").each(function(){var e=$(this).attr("id");p.push(e)})},s.readAsText(e)}),$("div#finder").find("div.items[tabindex=0]").focus()}function m(e){"+1"==e&&(++c<=v.length&&$("div[tabindex="+c+"]").focus(),c==v.length&&(c=0,$("div[tabindex=0]").focus())),"-1"==e&&(0<=--c&&$("div[tabindex="+c+"]").focus(),-1==c&&(c=v.length-1,$("div[tabindex="+c+"]").focus())),"slide_right"==e&&(c=0,r<p.length-1&&(r++,$("div.page").css("display","none"),$("div#"+p[r]).css("display","block"),"weather-wrapper"==p[r]&&t(),"quick-settings"==p[r]&&(v=document.querySelectorAll("div#quick-settings > div.items"),$("div#quick-settings").find("div.items[tabindex=0]").focus()),"finder"==p[r]&&(v=document.querySelectorAll("div#app-list > div.items"),$("div#app-list").find("div.items[tabindex=0]").focus()),"weather-wrapper"==p[r]&&(v=document.querySelectorAll("div#weather-wrapper div#weather-locations > div.items")))),"slide_left"==e&&(c=0)<r&&(r--,$("div.page").css("display","none"),$("div#"+p[r]).css("display","block"),"quick-settings"==p[r]&&(v=document.querySelectorAll("div#quick-settings > div.items"),$("div#quick-settings").find("div.items[tabindex=0]").focus()),"finder"==p[r]&&(v=document.querySelectorAll("div#app-list > div.items"),$("div#app-list").find("div.items[tabindex=0]").focus()),"weather-wrapper"==p[r]&&(v=document.querySelectorAll("div#weather-wrapper div#weather-locations > div.items")))}g();var h,b=[];function w(){$("div#finder div.items:visible");v=$("div#app-list > div.items:visible");for(var e=-1;e<v.length;e++)$(v[e]).attr("tabindex",e),c=0,$("div#finder").find("div.items[tabindex=0]").focus()}function y(){if(0==r){var e=$(":focus")[0],i=e.getAttribute("data-url");if($(e).hasClass("dir")&&0==l){$("div.items").css("display","none");var t=$("*:focus").eq(0).attr("class"),s=document.getElementsByClassName(t);return $(s).children(".dir-name").css("display","none"),$(s).children(".app-name").css("display","block"),$(s).css("display","block"),c=0,$("div#finder").find("div.items[tabindex=0]").focus(),l=1,$("div#finder div#app-list .dir").css("border","0px solid silver"),void w()}var n=window.navigator.mozApps.mgmt.getAll();n.onsuccess=function(){n.result&&n.result[i].launch()}}}function q(){if(0==r){var n=window.navigator.mozApps.mgmt.getAll();n.onsuccess=function(){if(n.result){var e=$(":focus")[0],i=e.getAttribute("data-url"),t=e.getAttribute("data-app_name"),s=navigator.mozApps.mgmt.uninstall(n.result[i]);s.error=function(e){alert("error: app not unistalled")},s.onsuccess=function(e){var i;i={body:t+" successfully uninstalled"},"Notification"in window?"granted"===Notification.permission?new Notification("App uninstall",i):"denied"!==Notification.permission&&Notification.requestPermission().then(function(e){"granted"===e&&new Notification("App uninstall",i)}):alert("This browser does not support desktop notification"),g(),setTimeout(function(){v=document.querySelectorAll("div#app-list > div.items"),$("div#app-list").find("div.items[tabindex=0]").focus()},3e3)}}}}}function A(e){0==r&&(document.querySelectorAll(".items")[e].focus(),y())}function x(t){var s=navigator.mozSettings.createLock().get("bluetooth.enabled");s.onsuccess=function(){var e=JSON.stringify(s.result);if('{"bluetooth.enabled":true}'==e){if("set"==t)(i=navigator.mozSettings.createLock().set({"bluetooth.enabled":!1})).onsuccess=function(){$("div#quick-settings div.bluetooth").css("opacity","0.5"),$("div#quick-settings div.bluetooth").css("font-style","italic")},i.onerror=function(){alert("An error occure, the settings remain unchanged")};"get"==t&&(f=!1,$("div#quick-settings div.bluetooth").css("opacity","1"),$("div#quick-settings div.bluetooth").css("font-style","normal"))}if('{"bluetooth.enabled":false}'==e){var i;if("set"==t)(i=navigator.mozSettings.createLock().set({"bluetooth.enabled":!0})).onsuccess=function(){$("div#quick-settings div.bluetooth").css("opacity","1"),$("div#quick-settings div.bluetooth").css("font-style","normal"),$("div#quick-settings div.airplane").css("opacity","0.5"),$("div#quick-settings div.airplane").css("font-style","italic"),navigator.mozSetMessageHandler("bluetooth-pairing-request",function(e){var i=e.detail;alert(i.name)})},i.onerror=function(){alert("An error occure, the settings remain unchanged")};"get"==t&&($("div#quick-settings div.bluetooth").css("opacity","0.5"),$("div#quick-settings div.bluetooth").css("font-style","italic"))}},s.onerror=function(){console.warn("An error occured: "+s.error)}}function S(t){var s=navigator.mozSettings.createLock().get("wifi.enabled");s.onsuccess=function(){var e=JSON.stringify(s.result);if('{"wifi.enabled":true}'==e){if("set"==t)(i=navigator.mozSettings.createLock().set({"wifi.enabled":!1})).onsuccess=function(){$("div#quick-settings div.wifi").css("opacity","0.5"),$("div#quick-settings div.wifi").css("font-style","italic")},i.onerror=function(){alert("An error occure, the settings remain unchanged")};"get"==t&&($("div#quick-settings div.wifi").css("opacity","1"),$("div#quick-settings div.wifi").css("font-style","normal"),f=!1)}if('{"wifi.enabled":false}'==e){var i;if("set"==t)(i=navigator.mozSettings.createLock().set({"wifi.enabled":!0})).onsuccess=function(){$("div#quick-settings div.wifi").css("opacity","1"),$("div#quick-settings div.wifi").css("font-style","normal"),$("div#quick-settings div.airplane").css("opacity","0.5"),$("div#quick-settings div.airplane").css("font-style","italic")},i.onerror=function(){alert("An error occure, the settings remain unchanged")};"get"==t&&($("div#quick-settings div.wifi").css("opacity","0.5"),$("div#quick-settings div.wifi").css("font-style","italic"),f=!1)}},s.onerror=function(){console.warn("An error occured: "+s.error)}}function z(t){var s=navigator.mozSettings.createLock().get("ril.data.enabled");s.onsuccess=function(){var e=JSON.stringify(s.result);if('{"ril.data.enabled":true}'==e){if("set"==t)(i=navigator.mozSettings.createLock().set({"ril.data.enabled":!1})).onsuccess=function(){$("div#quick-settings div.mobile-data").css("opacity","0.5"),$("div#quick-settings div.mobile-data").css("font-style","italic")},i.onerror=function(){alert("An error occure, the settings remain unchanged")};"get"==t&&($("div#quick-settings div.mobile-data").css("opacity","1"),$("div#quick-settings div.mobile-data").css("font-style","normal"),f=!1,L("get"))}if('{"ril.data.enabled":false}'==e){var i;if("set"==t)(i=navigator.mozSettings.createLock().set({"ril.data.enabled":!0})).onsuccess=function(){$("div#quick-settings div.mobile-data").css("opacity","1"),$("div#quick-settings div.mobile-data").css("font-style","normal"),$("div#quick-settings div.airplane").css("opacity","0.5"),$("div#quick-settings div.airplane").css("font-style","italic")},i.onerror=function(){alert("An error occure, the settings remain unchanged")};"get"==t&&($("div#quick-settings div.mobile-data").css("opacity","0.5"),$("div#quick-settings div.mobile-data").css("font-style","italic"))}},s.onerror=function(){console.warn("An error occured: "+s.error)}}function L(e){var i;("get"==e&&(1==f&&($("div#quick-settings div.airplane").css("opacity","1"),$("div#quick-settings div.airplane").css("font-style","normal")),0==f&&($("div#quick-settings div.airplane").css("opacity","0.5"),$("div#quick-settings div.airplane").css("font-style","italic"))),"set"==e&&0==f)&&((i=navigator.mozSettings.createLock().set({"bluetooth.enabled":!1,"wifi.enabled":!1,"ril.data.enabled":!1})).onsuccess=function(){$("div#quick-settings div.bluetooth").css("opacity","0.5"),$("div#quick-settings div.bluetooth").css("font-style","italic"),$("div#quick-settings div.wifi").css("opacity","0.5"),$("div#quick-settings div.wifi").css("font-style","italic"),$("div#quick-settings div.mobile-data").css("opacity","0.5"),$("div#quick-settings div.mobile-data").css("font-style","italic"),$("div#quick-settings div.airplane").css("opacity","1"),$("div#quick-settings div.airplane").css("font-style","normal"),f=!0},i.onerror=function(){alert("An error occure, the settings remain unchanged")});"set"==e&&1==f&&((i=navigator.mozSettings.createLock().set({"bluetooth.enabled":!0,"wifi.enabled":!0,"ril.data.enabled":!0})).onsuccess=function(){$("div#quick-settings div.bluetooth").css("opacity","1"),$("div#quick-settings div.bluetooth").css("font-style","normal"),$("div#quick-settings div.wifi").css("opacity","1"),$("div#quick-settings div.wifi").css("font-style","normal"),$("div#quick-settings div.mobile-data").css("opacity","1"),$("div#quick-settings div.mobile-data").css("font-style","normal"),$("div#quick-settings div.airplane").css("opacity","0.5"),$("div#quick-settings div.airplane").css("font-style","italic"),f=!1},i.onerror=function(){alert("An error occure, the settings remain unchanged")})}function N(n){var a=navigator.mozSettings.createLock().get("tethering.wifi.enabled");a.onsuccess=function(){var e=JSON.stringify(a.result);if('{"tethering.wifi.enabled":true}'==e){if("set"==n){var i=(s=navigator.mozSettings.createLock()).set({"tethering.wifi.enabled":!1});i.onsuccess=function(){$("div#quick-settings div.tethering").css("opacity","0.5"),$("div#quick-settings div.tethering").css("font-style","italic")},i.onerror=function(){alert("An error occure, the settings remain unchanged")}}"get"==n&&($("div#quick-settings div.tethering").css("opacity","1"),$("div#quick-settings div.tethering").css("font-style","normal"))}if('{"tethering.wifi.enabled":false}'==e){if("set"==n){var s,t=(s=navigator.mozSettings.createLock()).set({"tethering.wifi.enabled":!0});t.onsuccess=function(){$("div#quick-settings div.tethering").css("opacity","1"),$("div#quick-settings div.tethering").css("font-style","normal");var t=s.get("tethering.wifi.security.password");t.onsuccess=function(){var e=JSON.stringify(t.result),i=JSON.parse(e);$("div#message-box").text(i["tethering.wifi.security.password"]),$("div#message-box").css("display","block"),setTimeout(function(){$("div#message-box").text(""),$("div#message-box").css("display","none")},1e4)}},t.onerror=function(){alert("An error occure, the settings remain unchanged")}}"get"==n&&($("div#quick-settings div.tethering").css("opacity","0.5"),$("div#quick-settings div.tethering").css("font-style","italic"))}},a.onerror=function(){console.warn("An error occured: "+a.error)}}function _(e){if("geolocation"==e){var c={enableHighAccuracy:!0,timeout:3e4,maximumAge:0};navigator.geolocation.getCurrentPosition(function(e){var i=e.coords;s=i.longitude,n=i.latitude,t()},function(e){alert(e.code+":"+e.message)},c)}else t();function t(){var e="https://api.openweathermap.org/data/2.5/forecast?lat="+n+"&lon="+s+"&units=metric&APPID="+u;$.getJSON(e,function(e){}).done(function(t){var s="";function e(e){var i=t.list[e].wind.deg;switch(!0){case 337.5<i:case 292.5<i:s="N";break;case 247.5<i:s="W";break;case 202.5<i:s="SW";break;case 157.5<i:s="S";break;case 122.5<i:s="SE";break;case 67.5<i:s="E";break;case 22.5<i:s="NE"}}$("div#weather section").not(":first").remove();new Chart(ctx,{type:"line",data:t,options:c});for(var i=$("section#forecast-0"),n=-1,a=0;a<20;a++){n++,i.clone().attr("id","forecast-"+a).appendTo("div#weather");var o=moment.unix(t.list[n].dt).format("DD");Math.ceil(o/2)==o/2?$("div#location section#forecast-"+n).addClass("day-style-2"):$("div#location section#forecast-"+n).addClass("day-style-1");var r=moment.unix(t.list[n].dt).format("ddd DD MMM HH:mm");e(a),$("div#location section#forecast-"+a+" div#temp").text(Math.round(t.list[n].main.temp)+"°"),$("div#location section#forecast-"+a+" div#wind div#wind-speed div#wind-speed-val").text(t.list[n].wind.speed),$("div#location section#forecast-"+a+" div#wind div#wind-dir").text(s),$("div#location section#forecast-"+a+" div#pressure div#pressure-val").text(Math.round(t.list[n].main.pressure)),$("div#location section#forecast-"+a+" div.title div.forecast-time").text(r),$("div#location section#forecast-"+a+" div#icon img").attr("src","https://openweathermap.org/img/w/"+t.list[n].weather[0].icon+".png")}$("div#weather-wrapper div#message").css("display","none"),$("div#location").css("display","block")}).fail(function(){}).always(function(){})}}S("get"),x("get"),z("get"),N("get");var E=0,D=!1;document.addEventListener("keydown",function(e){switch(e.key){case"Enter":D=!1,E=0,h=setInterval(function(){2<++E&&(D=!0),E<2&&(D=!1)},1e3);break;case"Backspace":e.preventDefault(),0==l&&window.close(),1==l&&($("div.items").css("display","block"),$("div.items").children(".dir-name").css("display","block"),$("div.items").children(".app-name").css("display","none"),$("div.child-of-dir").css("display","none"),$("div#finder").find("div.items[tabindex=0]").focus(),$("div#finder div#app-list .dir").css("border-left","4px solid silver"),l=c=0,w())}}),document.addEventListener("keyup",function(e){switch(clearInterval(h),e.key){case"Enter":0==D&&(y(),function(){if("quick-settings"==p[r]){var e=$(":focus")[0].getAttribute("data-function");switch(!0){case"bluetooth"==e:x("set");break;case"wifi"==e:S("set");break;case"mobile_data"==e:z("set");break;case"tethering"==e:N("set");break;case"airplane"==e:L("set")}}}(),function(){if("weather-wrapper"==p[r]){var e=$(":focus")[0];s=e.getAttribute("data-long"),n=e.getAttribute("data-lat"),$("div#weather-wrapper div#locations").css("display","none"),$("div#weather-wrapper div#location").css("display","block"),_("notgeolocation")}}()),1==D&&q();break;case"Backspace":e.preventDefault();break;case"ArrowDown":m("+1");break;case"ArrowUp":m("-1");break;case"ArrowRight":m("slide_right");break;case"ArrowLeft":m("slide_left");break;case"SoftLeft":!function(){c=0,$("div#weather-wrapper div#locations").find("div.items[tabindex=0]").focus(),k=-1,$("div#weather-wrapper div#locations").empty();for(var e=0;e<d.length;e++)k++,$("div#weather-wrapper div#locations").append("<div class='items' tabindex="+k+" data-lat="+d[e][1]+" data-long="+d[e][2]+">"+d[e][0]+"</div>");"weather-wrapper"==p[r]&&($("div#weather-wrapper div#locations").css("display","block"),$("div#weather-wrapper div#location").css("display","none"),$("div#weather-wrapper div#locations div").first().focus(),v=document.querySelectorAll("div#weather-wrapper div#locations > div.items"))}();break;case"1":A(0);break;case"2":A(1);break;case"3":A(2);break;case"4":A(3);break;case"5":A(4);break;case"6":A(5);break;case"7":A(6);break;case"8":A(7);break;case"9":A(8);break;case"0":console.log("hey"),navigator.getDataStores("contacts").then(function(e){e[0].get(1,2,3).then(function(e){for(i=0;i<=e.length;i++)console.log(i)})})}}),$(window).on("error",function(e){console.log("jQuery error event:",e);var i=e.originalEvent;console.log("original event:",i),i.message?alert("Error:\n\t"+i.message+"\nLine:\n\t"+i.lineno+"\nFile:\n\t"+i.filename):alert("Error:\n\t"+i.type+"\nElement:\n\t"+(i.srcElement||i.target))})});